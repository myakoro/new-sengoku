<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ¦å›½BGMãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ - å…¨æ›²å¯¾å¿œ</title>
    <script src="https://cdn.jsdelivr.net/npm/abcjs@6.2.3/dist/abcjs-basic-min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', 'Yu Gothic', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-radius: 28px;
            padding: 45px;
            max-width: 1000px;
            width: 100%;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        h1 {
            color: #f0f0f0;
            text-align: center;
            margin-bottom: 35px;
            font-size: 2.2rem;
            font-weight: 700;
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.4);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .track-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .track-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .track-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .track-card:hover::before {
            left: 100%;
        }

        .track-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .track-card.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            border-color: #667eea;
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
        }

        .track-card h3 {
            color: #e8e8e8;
            font-size: 1.3rem;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .track-card .track-info {
            color: #b8b8b8;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .track-card .track-info span {
            display: block;
            margin-bottom: 5px;
        }

        .track-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .player-section {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 18px;
            padding: 35px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: linear-gradient(135deg, #555 0%, #666 100%);
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.6;
        }

        .tempo-control {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #e8e8e8;
            font-weight: 500;
        }

        input[type="range"] {
            width: 200px;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.6);
            transition: all 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.8);
        }

        input[type="range"]::-moz-range-thumb {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.6);
        }

        .notation-section {
            background: white;
            border-radius: 18px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.2);
        }

        #notation {
            overflow-x: auto;
            min-height: 150px;
        }

        .info-section {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 18px;
            padding: 30px;
            color: #e8e8e8;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-section h2 {
            margin-bottom: 18px;
            font-size: 1.4rem;
            color: #667eea;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid #667eea;
        }

        .info-item strong {
            color: #a8a8ff;
            display: block;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .info-item span {
            color: #e8e8e8;
            font-size: 1.1rem;
        }

        .status {
            text-align: center;
            color: #b8b8b8;
            font-size: 15px;
            margin-top: 18px;
            font-style: italic;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        .playing {
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes glow {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
            }

            50% {
                box-shadow: 0 0 30px rgba(102, 126, 234, 0.8);
            }
        }

        .track-card.active {
            animation: glow 2s ease-in-out infinite;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸµ æˆ¦å›½BGMãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ ğŸµ</h1>

        <div class="track-selector">
            <div class="track-card" data-track="shakuhachi">
                <span class="track-icon">ğŸ‹</span>
                <h3>å°ºå…«ã®èª¿ã¹</h3>
                <div class="track-info">
                    <span>Sengoku Shakuhachi</span>
                    <span>èª¿: G minor</span>
                    <span>ãƒ†ãƒ³ãƒ: 90 BPM</span>
                </div>
            </div>

            <div class="track-card" data-track="stealth">
                <span class="track-icon">ğŸŒ™</span>
                <h3>å¿ã³ã®è¶³éŸ³</h3>
                <div class="track-info">
                    <span>Sengoku Stealth</span>
                    <span>èª¿: A minor</span>
                    <span>ãƒ†ãƒ³ãƒ: 110 BPM</span>
                </div>
            </div>

            <div class="track-card" data-track="taiko">
                <span class="track-icon">ğŸ¥</span>
                <h3>å¤ªé¼“ã®éŸ¿ã</h3>
                <div class="track-info">
                    <span>Sengoku Taiko</span>
                    <span>èª¿: D minor</span>
                    <span>ãƒ†ãƒ³ãƒ: 120 BPM</span>
                </div>
            </div>

            <div class="track-card" data-track="melancholy">
                <span class="track-icon">ğŸ‚</span>
                <h3>åˆ‡ãªã„æƒ³ã„</h3>
                <div class="track-info">
                    <span>Sengoku Melancholy</span>
                    <span>èª¿: E minor</span>
                    <span>ãƒ†ãƒ³ãƒ: 72 BPM</span>
                </div>
            </div>

            <div class="track-card" data-track="ambition">
                <span class="track-icon">âš”ï¸</span>
                <h3>é‡å¿ƒã®ç‚</h3>
                <div class="track-info">
                    <span>Sengoku Ambition</span>
                    <span>èª¿: D minor</span>
                    <span>ãƒ†ãƒ³ãƒ: 140 BPM</span>
                </div>
            </div>

            <div class="track-card" data-track="nobunaga">
                <span class="track-icon">ğŸ¯</span>
                <h3>ä¿¡é•·ã®é‡æœ›</h3>
                <div class="track-info">
                    <span>Nobunaga's Vision</span>
                    <span>èª¿: D minor</span>
                    <span>ãƒ†ãƒ³ãƒ: 100 BPM</span>
                </div>
            </div>

            <div class="track-card" data-track="stealth_chase">
                <span class="track-icon">ğŸ’¨</span>
                <h3>è¿½è·¡ã®å½±</h3>
                <div class="track-info">
                    <span>Stealth Chase</span>
                    <span>èª¿: A minor</span>
                    <span>ãƒ†ãƒ³ãƒ: 140 BPM</span>
                </div>
            </div>

            <div class="track-card" data-track="stealth_infiltration">
                <span class="track-icon">ğŸŒ‘</span>
                <h3>æ½œå…¥ã®åˆ»</h3>
                <div class="track-info">
                    <span>Stealth Infiltration</span>
                    <span>èª¿: A minor</span>
                    <span>ãƒ†ãƒ³ãƒ: 80 BPM</span>
                </div>
            </div>

            <div class="track-card" data-track="stealth_tension">
                <span class="track-icon">âš¡</span>
                <h3>ç·Šè¿«ã®ç¬é–“</h3>
                <div class="track-info">
                    <span>Stealth Tension</span>
                    <span>èª¿: A minor (7/8)</span>
                    <span>ãƒ†ãƒ³ãƒ: 120 BPM</span>
                </div>
            </div>
        </div>

        <div class="player-section">
            <div class="controls">
                <button id="playBtn">â–¶ å†ç”Ÿ</button>
                <button id="pauseBtn" disabled>â¸ ä¸€æ™‚åœæ­¢</button>
                <button id="stopBtn" disabled>â¹ åœæ­¢</button>
                <div class="tempo-control">
                    <label for="tempo">ãƒ†ãƒ³ãƒ:</label>
                    <input type="range" id="tempo" min="60" max="180" value="90" step="5">
                    <span id="tempoValue">90</span> BPM
                </div>
            </div>
            <div class="status" id="status">æ›²ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
        </div>

        <div class="notation-section">
            <h2 style="margin-bottom: 20px; color: #333;">æ¥½è­œ</h2>
            <div id="notation"></div>
        </div>

        <div class="info-section">
            <h2>ç¾åœ¨ã®æ›²æƒ…å ±</h2>
            <div class="info-grid" id="trackInfo">
                <div class="info-item">
                    <strong>ã‚¿ã‚¤ãƒˆãƒ«</strong>
                    <span id="infoTitle">-</span>
                </div>
                <div class="info-item">
                    <strong>ä½œæ›²</strong>
                    <span id="infoComposer">Cascade</span>
                </div>
                <div class="info-item">
                    <strong>æ‹å­</strong>
                    <span id="infoMeter">4/4</span>
                </div>
                <div class="info-item">
                    <strong>èª¿</strong>
                    <span id="infoKey">-</span>
                </div>
                <div class="info-item">
                    <strong>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ³ãƒ</strong>
                    <span id="infoTempo">-</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ABC notations for all tracks
        const tracks = {
            shakuhachi: {
                name: "Sengoku Shakuhachi (10s)",
                abc: `X:1
T:Sengoku Shakuhachi (10s)
C:Cascade
M:4/4
L:1/8
Q:1/4=90
K:Gm
V:1
|: G3 A B2 A2 | G4 D2 G2 | A3 G F2 D2 | G2 A2 B2 c2 | d6 B2 :|`,
                defaultTempo: 90,
                key: "G minor (ãƒˆçŸ­èª¿)",
                icon: "ğŸ‹"
            },
            stealth: {
                name: "Sengoku Stealth (10s)",
                abc: `X:1
T:Sengoku Stealth (10s)
C:Cascade
M:4/4
L:1/8
Q:1/4=110
K:Am
V:1
|: A,2 E2 A2 c2 | B,2 E2 B2 d2 | A,2 E2 A2 e2 | c2 B2 A2 G2 | A6 z2 :|`,
                defaultTempo: 110,
                key: "A minor (ã‚¤çŸ­èª¿)",
                icon: "ğŸŒ™"
            },
            taiko: {
                name: "Sengoku Taiko (10s)",
                abc: `X:1
T:Sengoku Taiko (10s)
C:Cascade
M:4/4
L:1/8
Q:1/4=120
K:Dm
V:1
|: D2 A2 d2 A2 | D2 A2 d2 A2 | F2 A2 f2 A2 | E2 A2 e2 A2 | D2 A2 d4 :|`,
                defaultTempo: 120,
                key: "D minor (ãƒ‹çŸ­èª¿)",
                icon: "ğŸ¥"
            },
            melancholy: {
                name: "Sengoku Melancholy (10s)",
                abc: `X:1
T:Sengoku Melancholy (10s)
C:Cascade
M:3/4
L:1/8
Q:1/4=72
K:Em
V:1
|: E3 F G2 | B4 A2 | G3 F E2 | D4 E2 | F3 E D2 | E6 | B,3 C D2 | E6 :|`,
                defaultTempo: 72,
                key: "E minor (ãƒ›çŸ­èª¿)",
                icon: "ğŸ‚"
            },
            ambition: {
                name: "Sengoku Ambition (10s)",
                abc: `X:1
T:Sengoku Ambition (10s)
C:Cascade
M:4/4
L:1/8
Q:1/4=140
K:Dm
V:1
|: D2 F2 A2 d2 | c2 A2 F2 D2 | E2 G2 c2 e2 | d2 c2 A2 F2 | D2 A2 d2 f2 | e2 d2 c2 A2 | G2 F2 E2 D2 | D8 :|`,
                defaultTempo: 140,
                key: "D minor (ãƒ‹çŸ­èª¿)",
                icon: "âš”ï¸"
            },
            nobunaga: {
                name: "Nobunaga's Vision (10s)",
                abc: `X:1
T:Nobunaga's Vision (10s)
C:Cascade
M:4/4
L:1/8
Q:1/4=100
K:Dm
V:1
|: D2 F2 A2 d2 | A2 F2 D4 | G2 B2 d2 g2 | d2 B2 G4 | A2 c2 e2 a2 | f2 d2 A4 | D2 A2 d2 f2 | d8 :|`,
                defaultTempo: 100,
                key: "D minor (ãƒ‹çŸ­èª¿)",
                icon: "ğŸ¯"
            },
            stealth_chase: {
                name: "Stealth Chase (10s)",
                abc: `X:1
T:Stealth Chase (10s)
C:Cascade
M:4/4
L:1/16
Q:1/4=140
K:Am
V:1
|: A,4 E4 A4 c4 | B,4 E4 B4 d4 | A,4 E4 A4 e4 | c4 B4 A4 G4 | A,4 E4 A4 c4 | B,4 d4 e4 d4 | c4 A4 G4 E4 | A12 z4 :|`,
                defaultTempo: 140,
                key: "A minor (ã‚¤çŸ­èª¿)",
                icon: "ğŸ’¨"
            },
            stealth_infiltration: {
                name: "Stealth Infiltration (10s)",
                abc: `X:1
T:Stealth Infiltration (10s)
C:Cascade
M:4/4
L:1/8
Q:1/4=80
K:Am
V:1
|: A,3 E A3 c | B,3 E B3 d | A,3 E A3 e | c3 B A3 G | A,2 E2 A2 c2 | B,2 d2 c2 B2 | A,2 G,2 E,2 A,2 | A,8 :|`,
                defaultTempo: 80,
                key: "A minor (ã‚¤çŸ­èª¿)",
                icon: "ğŸŒ‘"
            },
            stealth_tension: {
                name: "Stealth Tension (10s)",
                abc: `X:1
T:Stealth Tension (10s)
C:Cascade
M:7/8
L:1/8
Q:1/4=120
K:Am
V:1
|: A,2 E2 A2 c | B,2 E2 B2 d | A,2 E2 A2 e | c2 B2 A2 G | A,2 E2 A c2 | B,2 d2 e d2 | c2 A2 G E2 | A6 z :|`,
                defaultTempo: 120,
                key: "A minor (ã‚¤çŸ­èª¿) 7/8",
                icon: "âš¡"
            }
        };

        let currentTrack = null;
        let synthControl = null;
        let currentTempo = 90;

        // Initialize
        function init() {
            setupTrackSelector();
            setupControls();
        }

        function setupTrackSelector() {
            const trackCards = document.querySelectorAll('.track-card');
            trackCards.forEach(card => {
                card.addEventListener('click', () => {
                    const trackId = card.dataset.track;
                    selectTrack(trackId);
                });
            });
        }

        function selectTrack(trackId) {
            currentTrack = tracks[trackId];

            // Update UI
            document.querySelectorAll('.track-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`[data-track="${trackId}"]`).classList.add('active');

            // Update tempo
            currentTempo = currentTrack.defaultTempo;
            document.getElementById('tempo').value = currentTempo;
            document.getElementById('tempoValue').textContent = currentTempo;

            // Update track info
            document.getElementById('infoTitle').textContent = currentTrack.name;
            document.getElementById('infoKey').textContent = currentTrack.key;
            document.getElementById('infoTempo').textContent = currentTrack.defaultTempo + ' BPM';

            // Render notation
            renderNotation();

            // Update status
            document.getElementById('status').textContent = 'æº–å‚™å®Œäº†';
            document.getElementById('playBtn').disabled = false;
        }

        function renderNotation() {
            if (!currentTrack) return;

            const updatedAbc = currentTrack.abc.replace(/Q:1\/4=\d+/, `Q:1/4=${currentTempo}`);
            ABCJS.renderAbc("notation", updatedAbc, {
                responsive: "resize",
                scale: 1.2
            });
        }

        function setupControls() {
            const playBtn = document.getElementById('playBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const stopBtn = document.getElementById('stopBtn');
            const tempoSlider = document.getElementById('tempo');
            const tempoValue = document.getElementById('tempoValue');
            const status = document.getElementById('status');

            playBtn.addEventListener('click', async () => {
                if (!currentTrack) {
                    status.textContent = 'æ›²ã‚’é¸æŠã—ã¦ãã ã•ã„';
                    return;
                }

                try {
                    status.textContent = 'èª­ã¿è¾¼ã¿ä¸­...';

                    // Update tempo in ABC notation
                    const updatedAbc = currentTrack.abc.replace(/Q:1\/4=\d+/, `Q:1/4=${currentTempo}`);

                    // Render with updated tempo
                    const visualObj = ABCJS.renderAbc("notation", updatedAbc, {
                        responsive: "resize",
                        scale: 1.2
                    })[0];

                    // Create synth
                    if (ABCJS.synth.supportsAudio()) {
                        synthControl = new ABCJS.synth.SynthController();
                        await synthControl.load("#notation", null, {
                            displayLoop: true,
                            displayRestart: true,
                            displayPlay: true,
                            displayProgress: true,
                            displayWarp: true
                        });

                        await synthControl.setTune(visualObj, false);
                        await synthControl.play();

                        status.textContent = `å†ç”Ÿä¸­: ${currentTrack.name}`;
                        status.classList.add('playing');
                        playBtn.disabled = true;
                        pauseBtn.disabled = false;
                        stopBtn.disabled = false;
                    } else {
                        status.textContent = 'ã‚¨ãƒ©ãƒ¼: ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“';
                    }
                } catch (error) {
                    console.error('Playback error:', error);
                    status.textContent = 'ã‚¨ãƒ©ãƒ¼: å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ';
                }
            });

            pauseBtn.addEventListener('click', () => {
                if (synthControl) {
                    synthControl.pause();
                    status.textContent = 'ä¸€æ™‚åœæ­¢ä¸­';
                    status.classList.remove('playing');
                    playBtn.disabled = false;
                    pauseBtn.disabled = true;
                }
            });

            stopBtn.addEventListener('click', () => {
                if (synthControl) {
                    synthControl.stop();
                    status.textContent = 'åœæ­¢';
                    status.classList.remove('playing');
                    playBtn.disabled = false;
                    pauseBtn.disabled = true;
                    stopBtn.disabled = true;
                }
            });

            tempoSlider.addEventListener('input', (e) => {
                currentTempo = parseInt(e.target.value);
                tempoValue.textContent = currentTempo;
                if (currentTrack) {
                    renderNotation();
                }
            });
        }

        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>