# 戦国立身出世SLG Version 0.1 要件定義書

**作成日：2025年12月13日**  
**バージョン：0.1**

---

## 1. 目的

Version 0.1 の目的は、ゲームのコア体験（功績を積み、出世していく）を、短時間でプレイ可能な範囲に切り出して提供することである。

- ゴール：**徒士 → 馬上衆 → 小頭** への到達
- 到達時点でエンディング

---

## 2. 前提・参照ドキュメント

- `GDD及び経緯サマリー/GDD_v1.1.md`
- `詳細設計書/Version0.1_詳細設計書.md`
- `画面設計書/Version0.1_画面設計書.md`

---

## 3. スコープ

### 3-1. 実装範囲（Version 0.1）

- ターン制（行動単位）
- 主命（訓練/巡察/情報収集/護衛任務/盗賊討伐）
- 盗賊討伐（計略・戦闘・報酬）
- 下知（次の評定までの期限付き目標）
- 月次処理（扶持米・支出・借金・簡易補充・出世判定・評定）
- AIライバル（功績競争）
- エンディング

### 3-2. 非対象（Version 0.1 ではやらない）

- 知行地、軍役、農兵
- 私事（内政/外交などの拡張要素）
- 家臣団の名前・個性
- 複雑な戦闘詳細（Version 0.5 以降）

---

## 4. 用語・時間仕様

- **ターン**：プレイヤーが 1 回行動する単位。
- **暦上の1週**：2ターン（前半/後半）
- **月次処理（評定）**：8ターンごと（= 4週ごと）
- **ゲーム期間**：3年（= 156週 = 312ターン）

- **小頭評定**：4ターンごと（`1, 5, 9, 13, ...`）
  - 1か月=8ターンのうち、**1ターン目・5ターン目**が小頭評定
  - 下知（期限付き目標）の裁定/発行は小頭評定で行う

---

## 5. 主要ゲームループ要件

### 5-1. 週次（ターン）ループ

1. メイン画面で状況を確認
2. 主命を選択
3. 主命を実行（ターン消費）
4. 結果表示
5. 小頭評定ターンなら小頭評定へ
6. 月次境界なら月次報告へ
7. 次ターンへ

### 5-2. 月次ループ（評定）

- 収入（扶持米）
- 支出（若党扶持、生活費、馬維持費）
- 余剰米の使い道選択
- 借金返済（任意）
- 若党補充（不足時）
- 出世判定
- 評定（コメント）

---

## 6. 画面要件（UI）

画面IDは `画面設計書/Version0.1_画面設計書.md` に準拠する。

- SC-01 タイトル
- SC-02 キャラメイク
- SC-03 メイン
  - **下知（次の小頭評定まで）**の表示（目標/判定/未達ペナルティ）
- SC-04 主命選択
- SC-05 結果
- SC-05A 小頭評定
- SC-06 月次報告
- SC-07 出世
- SC-08 盗賊討伐
- SC-09 計略
- SC-10 戦闘結果
- SC-11 エンディング

---

## 7. データ要件（状態管理）

最低限、以下の状態を保持できること。

- プレイヤー状態（身分、功績、資産、兵、能力、ターン数など）
- 盗賊討伐ミッション状態（期限、進行ターン、盗賊状態、実行済み計略など）
- 下知状態（目標主命、期限ターン、成功時功績、達成状態）
- ログ
- ライバル状態

---

## 8. 主命（行動）要件

主命は `constants/game.ts` の設定に準拠する。

- 期間 `duration` は **消費ターン数**。
- `duration = 1` は通常主命（1ターンで完了）。
- `duration >= 2` は盗賊討伐ミッションとして開始される。

### 8-0. 通常主命の詳細

| 主命 | 功績 | 経験値 | 特殊効果 |
|------|------|--------|----------|
| 訓練 | +5 | 武芸+5 | なし |
| 巡察 | +3 | なし | 20%で盗賊遭遇（Cランク討伐ミッション自動開始） |
| 情報収集 | +5 | 知略+10 | 成功率判定あり（60%+知略×0.7）。失敗時は功績0 |
| 護衛任務 | +8 | なし | 10%で襲撃イベント。撃退成功で+5、失敗で功績0 |

### 8-1. 主命の解放条件（役職制限）

- 主命は役職により選択可能範囲が変化する。
- `requireRank` は「その役職**以上**で選択可能」を意味する（下限役職）。

Version 0.1 の解放条件：

- 徒士：
  - `訓練`
  - `巡察`
  - `情報収集`
  - `護衛任務`
  - `盗賊討伐（小規模）`
  - `盗賊討伐（中規模）`
- 馬上衆：
  - 徒士の全主命
  - `盗賊討伐（大規模）`
  - `盗賊討伐（討伐戦）`
- 小頭：
  - 馬上衆の全主命
  - `盗賊討伐（賊軍）`

---

## 9. 盗賊討伐要件

### 9-1. ランクとターン数

- D：4ターン（次の小頭評定まで）
- C：4ターン（次の小頭評定まで）
- B：4ターン（次の小頭評定まで）
- A：4ターン（次の小頭評定まで）
- S：8ターン（小頭向け。組頭/足軽大将など上位からの「治安回復」または「賊軍討伐」等の下知に相当）

#### 位置づけ（下知の階層）

- 徒士/馬上衆が行う盗賊調査・盗賊討伐（D〜A）は、世界観上は「小頭が上から受けた治安関連タスク」を分割し、配下へ下知したものとして扱う。
- Sランク（賊軍）は、小頭に対して「特定の賊軍を名指しで討伐せよ」といった形で上位から下知されるケースを想定する（タスクの性質としては治安回復と同列）。

### 9-2. 計略（準備フェーズ）

計略は以下を提供する。

- 偵察
- 偽情報
- 内応者買収
- 足軽雇用

#### 成功率

- 知略に依存する（詳細は詳細設計書参照）
- 偵察済みボーナスあり
- 弱点ボーナスあり（計略と弱点の組み合わせが一致する場合）
- 上限95%、下限5%

#### 偽情報

- 成功時、敵士気を減少
  - 通常：-10
  - 弱点「統率不足」時：-18

#### 内応者買収

- 費用：0.3貫
- 効果：敵戦力-10%扱い（内応者フラグ）
- 使用条件（Version 0.1）：
  - **偵察済み**
  - **敵勢力10名以上**

### 9-3. 戦闘（決戦フェーズ）

- 戦闘成功率：戦力差に応じて変動（詳細は詳細設計書参照）
- 戦闘結果に応じて損害を発生させる。
- 勝利時：功績/報酬を得る。

#### 行動（4ターン枠内）

- D/C/B/A の盗賊討伐は「次の小頭評定までに結果を出せ」という下知の一部として扱い、**期限は4ターン**とする。
- この4ターン枠の中で、プレイヤーは
  - 計略（偵察/偽情報/内応者買収/足軽雇用）
  - 様子を見る（待機）
  - 攻撃（通常攻撃/夜襲）
  を **任意の順番**で選択できる（攻撃は任意ターンで実行可能）。
- 盗賊討伐ミッション中は、準備行動（偵察/偽情報/内応者買収/足軽雇用）を「若党に委任」して実行できる。
  - 委任した準備行動はミッション進行（行動ターン消費）として扱うが、主人公の行動ターンは消費しない。
  - その代わり、同一ターンにミッション画面側で追加の行動はできない（委任済み扱い）。
  - 委任の担当若党は自動的に適任者（例：知略が高い若党）を選択するが、プレイヤーが手動で切り替え可能。
  - 行動ログには「担当若党」「成功率」「効果量（例：士気低下値など）」が分かる形で表示される。
- 4ターンを消費しても討伐が完了していない場合、その時点では下知未達（小頭評定で裁定）となる。
- UI上は分かりやすさのため、最終ターンは「攻撃のみ」選択可能としてよい。

#### 夜襲

- 夜襲を選択した場合、決戦の成功率に `-10` の補正をかける。
- 代わりに敵士気を `-20` して敵戦力を下げてよい。

#### 報酬（戦利品 + 上司報酬）

- 盗賊側には「財産（米/金）」がある。
- 勝利時、プレイヤーは盗賊の財産のうち **半分**を戦利品として得る。
- 追加で、ランクに応じた「上司からの報酬（米/金）」を得る。
- 表示上は「盗賊の財産（取り分）」「上司からの報酬」「合計」を分けて表示してよい。

#### 損害と功績ペナルティ（雇い足軽）

- Version 0.1 では、死亡/負傷は主に「若党（従僕）」へ適用して戦力低下を表現する。
- ミッション中に「足軽雇用」で増えた **雇い足軽** が死亡した場合のみ、功績ペナルティを適用する（詳細は詳細設計書参照）。
- プレイヤー配下（若党/徒士/馬上衆）の死亡では功績は減少しない。

### 9-4. 月次処理との関係（Version 0.1 方針）

- Version 0.1 では、盗賊討伐ミッション進行中に月次画面へ **強制割り込みしない**。
- 月次境界に到達している場合は、ミッション終了（結果を閉じる）または中止で画面を離れるタイミングで月次へ遷移する。

小頭評定との関係：

- Version 0.1 では、盗賊討伐ミッション進行中に小頭評定画面へ **強制割り込みしない**。
- 小頭評定ターンに到達している場合は、ミッション終了（結果を閉じる）または中止で画面を離れるタイミングで小頭評定へ遷移する。

---

### 9-5. 巡察で発見した盗賊（カード化）

- 巡察中に盗賊遭遇（20%）した場合、盗賊討伐ミッションを自動開始せず、**盗賊情報（カード）**として保持する。
- 盗賊カードはランクがまちまちでよい（D/C/B/A/S）。
- カードはメイン画面で一覧表示され、任意タイミングで以下を選択できる。
  - **討伐する**：盗賊討伐ミッションを開始する。
    - 巡察カード由来で討伐した場合、**戦利品（盗賊財産の取り分）が2倍**になる（上司報酬は通常どおり）。
  - **報告する**：上司へ上申してカードを消滅させ、**討伐功績の40%**を得る。

#### カードの経過ルール

- 発見から2か月で盗賊ランクが1段階上昇する（D→C→B→A→S）。
- 発見からさらに2か月（合計4か月）で、その盗賊は他勢力に討伐された扱いとなりカードは消滅する。

---

## 10. 下知（小頭評定までの期限付き目標）要件

### 10-1. 発行

- 徒士/馬上衆の間、プレイヤーには「次の小頭評定までに指定主命を達成せよ」という下知が付与される。
- 目標と期限はメイン画面で確認できる。

#### 開始ターン固定の下知（例外）

- 稀に「開始ターン固定」の下知が発行される。
- 開始ターン固定の下知は `fixedStartTurn` を持ち、**そのターンに入った瞬間に強制的に開始**される。
- Version 0.1 の例：
  - `全体訓練`（強制開始、1ターン拘束）
  - `賊軍偵察`（強制開始、1ターン拘束）

発行タイミング（実装準拠）：

- 新規ゲーム開始直後の小頭評定（1ターン目）で1件発行する。
- 以降は小頭評定（4ターンごと）で次の下知を発行する。
- プレイヤーが小頭に到達した場合、下知は発行しない（下知状態は`null`）。

下知ターゲット（実装準拠）：

- 徒士：`盗賊討伐（小規模）`
- 馬上衆：`盗賊討伐（中規模）`

期限（実装準拠）：

- 期限は「次の小頭評定ターン」とする（4ターン周期）。
- 小頭評定ターンは `1, 5, 9, 13, ...`。
- 下知発行時点の現在ターンから次の小頭評定を期限`dueTurn`として設定する。

### 10-2. 達成条件

- 下知が要求する主命に該当する盗賊討伐に **成功**した場合、下知は達成となる。

達成判定（実装準拠）：

- 「盗賊討伐」の**戦闘に勝利**したときにのみ達成判定する（中止・失敗・準備行動のみでは達成しない）。
- ミッションランクと主命名の対応は以下とする。
  - D：`盗賊討伐（小規模）`
  - C：`盗賊討伐（中規模）`
  - B：`盗賊討伐（大規模）`
  - A：`盗賊討伐（討伐戦）`
  - S：`盗賊討伐（賊軍）`
- 下知ターゲットと一致する勝利のみ「達成」とする。

### 10-3. 未達/失敗時ペナルティ

- 評定（=月次）開始時点で下知が未達（activeのまま）なら、功績にペナルティを与える。
- ペナルティ：**成功時功績の40%**（小数切り捨て）
- 功績が0未満にならないようにする。

未達判定と適用タイミング（実装準拠）：

- 小頭評定画面に入った時点で、現在ターンが期限`dueTurn`以上かつ下知が`active`の場合、未達として扱う。
- 未達となった下知は`failed`に更新する。
- 下知が`failed`または`succeeded`の場合は、同じ月次内で二重にペナルティを適用しない。

次の下知（実装準拠）：

- 次の下知は、小頭評定で新規発行する（成功・失敗どちらでも発行する）。

---

## 11. 出世要件

- 徒士 → 馬上衆
- 馬上衆 → 小頭

条件値は `constants/game.ts` の `PROMOTION_REQUIREMENTS` に準拠する。

---

## 12. 非機能要件

- Windows環境で動作すること
- Electron + Vite + React + TypeScript + Zustand
- `npx tsc --noEmit` が成功すること

---

## 13. 受け入れ基準（完了条件）

- タイトル → キャラメイク → メイン → 主命 → 結果 → 月次 → メイン の循環が成立する
- 下知が表示され、達成/未達時の挙動（40%ペナルティ）が成立する
- 盗賊討伐（計略→戦闘→結果）が成立する
- 小頭到達でエンディングへ遷移する
