# Version 0.17 要件定義書

## 1. 概要

### 1-1. バージョン目標

```
目標：v0.15 の「単調さ（クリック連打で最適化される状態）」を解消し、意思決定と学びが発生する状態にする
プレイ時間：徒士→小頭が10分で到達しない（目安：30分前後）
前提：Version 0.15
```

### 1-1-2. 方針（考える場所の設計）

```
- 「準備」だけでなく「戦闘中の操作（陣形/姿勢/撤退など）」でも考えさせる
- 金銭不足（装備/雇用/買収ができない）と、手柄（功績）を取りに行くリスク（損耗/負傷）のトレードオフを体感できる
- クリック回数を増やすのではなく、1回の意思決定の価値を上げる

- 下知（命令）は「討伐の指示」ではなく、上位の方針が段階的に具体化されて末端に伝達される
  - 殿様と側近（殿様→家老／部将）（大評定）
  - 側近から現場責任者（家老／部将→侍大将／足軽大将）
  - 現場責任者から現場運用者へ（侍大将／足軽大将→組頭／小頭）
  - 現場運用者から現場へ（組頭／小頭→馬上衆、徒士）

  - 表示イメージ（例）：
    - 「侍大将の羽柴様から命令があり、今月は治安の回復に努めることにあいなった。」
```

### 1-2. 解決したい問題（現状の課題）

```
- どの行動を選んでも結果が同じ（差分がない）
- 失敗や副作用がない（最適解が単一）
- 進捗が単調に足し算（考えなくても到達できる）
- ログが通知で終わり、次の意思決定に繋がらない
- 下知（命令）が固定化しており、同じ流れが周期的に繰り返される（通知→開始→討伐→通知...）

特に顕著：
- 盗賊討伐が「偵察なしで初手攻撃→押し切り」が成立する
- 戦闘が一律に見え、駆け引きや展開の幅が薄い
- 徒士→小頭までが短時間で到達する
```

### 1-3. 主要追加/変更（v0.17でやること）

| 項目 | 優先度 | 概要 |
|------|--------|------|
| 下知（命令）を階層フロー前提で再設計 | 高 | 下知を「討伐固定」から外し、上位方針→目標→現場実行へ段階的に落ちる形へ変更する（同一テンプレ反復を防ぐ） |
| 治安回復をゲージ（進捗）で表現 | 高 | 上位の方針（例：治安回復）を、月次の進捗（ゲージ/数値）として可視化し、手段（巡察/情報収集/討伐など）の成果が反映されるようにする |
| 偵察が戦闘/計略に効く調整 | 高 | 未偵察での不確実性・不利、偵察成功での優位（成功率/損耗/選択肢）を導入する |
| 盗賊戦闘の一律感を減らす | 高 | 敵個体差、ダメージ配分の偏り、展開の幅を最小変更で入れる |
| 出世ペース調整 | 高 | 徒士→小頭が短時間で到達しないよう、功績供給/昇進条件/リスクを調整する |
| 戦闘中の意思決定を成立させる | 高 | 姿勢/入替/撤退などの選択が勝敗・損耗・手柄に影響し、連打で最適化されないようにする |
| 金銭不足と手柄の焦りの表現 | 高 | 資金の不足が選択肢を狭め、リスクを取って手柄を取りに行く誘惑と怖さが両立するようにする |
| ログの学び強化 | 中 | 「なぜそうなったか」「次は何を変えるべきか」が残るログにする |

---

## 2. スコープ（v0.17で実装する範囲）

### 2-1. 対象範囲

```
- v0.15の既存ループ（徒士〜小頭、盗賊討伐、評定/ログ）を前提に、単調さの原因を改修する
- 新しい大型ループ（v0.25の小頭任務/委任）には入らない
```

### 2-2. 具体対象（候補）

```
- 下知（命令）
  - 「討伐固定」ではなく、上位方針が目標化されて末端へ落ちる形へ変更
  - 同一テンプレ反復（通知→開始→討伐→通知...）が起きないこと

- 治安（進捗ゲージ）
  - 上位方針（例：治安回復）をゲージ（進捗）で表現し、評定（期限）で達成判定できる
  - 手段（巡察/情報収集/討伐など）の成果がゲージへ反映される

- 盗賊討伐
  - 偵察の扱い
  - 攻撃/夜襲/計略の期待値差
  - 損耗（負傷/死亡）の期待値と、意思決定への影響
  - 戦闘中の意思決定（姿勢/入替/撤退）と結果の差
  - 金銭（買収/雇用）とリスクの取り方の差

- 功績（出世ペース）
  - 公務/戦闘の功績供給
  - 昇進条件

- ログ
  - 行動理由/結果理由の出力
```

---

## 3. 非スコープ（v0.17で「やらない」こと）

```
- v0.25の小頭ループ（任務・委任・進捗%管理）の導入
- キャラクター画像/顔アイコン/立ち絵の本格導入（表示基盤は将来）
- 画面の大規模増設（基本は既存画面内の改修）
- 大量のイベント追加
```

---

## 4. 受け入れ条件（出口条件）

### 4-1. 単調さ解消の判定

```
- 下知（命令）が周期的に「同じ討伐」を繰り返す状態にならない
  - 下知は上位方針→目標→現場実行へ段階的に落ちる（討伐は手段の一つになり得る）
  - 「通知→開始→討伐→通知...」の固定手順が常に最適にならない
  - 上位（例：侍大将）からの方針が、評定/ログ/画面表示として確認できる

- 治安回復（進捗ゲージ）が、プレイヤーの行動結果として可視化される
  - 行動結果により進捗が増える/（必要なら）放置で進捗が伸びない等の差が出る
  - 評定（期限）で「進捗が十分か」を判定できる

- 盗賊討伐で「偵察なし初手攻撃」が常に最適にならない
  - 偵察をした方が期待値で得になる状況が存在する
  - 偵察をしないと、成功率低下/損耗増加/不利条件などの不確実性が発生する

- 戦闘が毎回同じになりにくい
  - 敵個体差やダメージ偏りにより、前線の崩れ方/損耗が変化する

- 戦闘中の操作でも考える必要がある
  - 姿勢/入替/撤退の選択により、勝率・損耗・手柄（功績）に差が出る
  - 「常に同じ姿勢」「常に殴り続ける」「撤退しない」が常に最適にはならない

- 金銭不足と手柄（功績）不足の圧が両立する
  - 安全策（損耗が少ない）が存在するが、金/功績が伸びにくい
  - 攻め手（手柄が出る）が存在するが、損耗/負傷/金銭悪化のリスクがある

- 出世が10分で到達しない
  - 徒士→小頭までの目安プレイ時間を満たす（数値は詳細設計で確定）

- ログを読むことで次の意思決定が変わる
  - 「失敗の理由」「損耗の理由」「次の打ち手」がログから読み取れる
```

---

## 5. 次のステップ

1. v0.17のプレイ時間目標（徒士→小頭）を決める
2. 下知（命令）の伝達フロー前提を確定する（上位方針→目標→現場実行）
3. 治安回復（進捗ゲージ）の仕様を決める（範囲/増減ルール/評定での判定/表示）
4. 盗賊討伐の「偵察が効く」仕様を決める（未偵察ペナルティ/偵察ボーナス/weakness補正のどれを採用するか）
5. 戦闘の一律感を減らす最小修正点を決める（敵個体差/ダメージ配分）
6. 戦闘中の意思決定が効くポイントを決める（姿勢/入替/撤退がどこに効くか）
7. 出世ペースの調整方針を決める（供給/閾値/副作用）
8. 詳細設計書（Version0.17_詳細設計書.md）へ落とし込み、実装に入る
